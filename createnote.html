<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>नोट सम्पादन गर्नुहोस्</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="page-container">
        <header class="header">
            <a href="notelist.html" class="back-arrow">&#8592;</a>
            <h1 class="page-title">नोट सम्पादन गर्नुहोस्</h1>
        </header>
        <main class="content">
            <div class="input-group">
                <input type="text" id="note-title" class="note-input" placeholder="शीर्षक लेख्नुहोस्...">
            </div>

            <div class="note-card green-border">
                <textarea id="note-description" class="note-content-textarea" placeholder="नोटको विवरण लेख्नुहोस्..."></textarea>
            </div>

            <div class="priority-checkbox-group">
                <input type="checkbox" id="highPriority" class="custom-checkbox">
                <label for="highPriority" class="checkbox-label">उच्च प्राथमिकता</label>
            </div>
        </main>
        <footer class="footer">
            <div class="action-buttons">
                <button id="save-note" class="save-button">सेभ गर्नुहोस्</button>
                <button id="cancel" class="cancel-button">रद्द गर्नुहोस्</button>
            </div>
        </footer>
    </div>

    <script>
    const API_BASE = "http://192.168.1.209:8000/api";
const NOTE_ID = new URLSearchParams(window.location.search).get("id");
const token = localStorage.getItem("auth_token");

if (!token) {
    alert("You are not logged in!");
    window.location.href = "login.html";
}

async function loadNote() {
    if (!NOTE_ID) return; // skip if creating
    try {
        const res = await fetch(`${API_BASE}/notes/${NOTE_ID}`, {
            headers: {
                "Authorization": `Bearer ${token}`,
                "Accept": "application/json"
            }
        });

        if (!res.ok) throw new Error("Failed to load note");
        const note = await res.json();
        document.getElementById("note-title").value = note.title || "";
        document.getElementById("note-description").value = note.description || "";
        document.getElementById("highPriority").checked = note.high_priority ?? false;
    } catch (err) {
        alert(err.message);
    }
}

document.getElementById("save-note").addEventListener("click", async () => {
    const title = document.getElementById("note-title").value.trim();
    const description = document.getElementById("note-description").value.trim();
    const highPriority = document.getElementById("highPriority").checked;

    if (!title) {
        alert("शीर्षक आवश्यक छ!");
        return;
    }

    try {
        const res = await fetch(
            NOTE_ID ? `${API_BASE}/notes/${NOTE_ID}` : `${API_BASE}/notes`,
            {
                method: NOTE_ID ? "PUT" : "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`,
                    "Accept": "application/json"
                },
                body: JSON.stringify({ title, description, high_priority: highPriority })
            }
        );

        if (!res.ok) {
            const errData = await res.json().catch(() => ({}));
            throw new Error(errData.message || "Failed to save note");
        }

        const note = await res.json();
        alert(NOTE_ID ? "नोट अपडेट गरियो!" : "नोट बन्यो!");
        window.location.href = `notelist.html?id=${note.id}`;
    } catch (err) {
        alert(err.message);
    }
});

document.getElementById("cancel").addEventListener("click", () => {
    window.location.href = "notelist.html";
});

loadNote();


    </script>
</body>
</html>
